$('#messageSuccessfullySent').html("<%= j render 'success' %>");
$('#newMessage').modal('hide');
$('#messageSuccess').modal({ backdrop: 'static' });
$('#message-<%= @first_message.try(:id) %>').remove();
$('.messages-wrapper').prepend("<%= j render 'message', message: @message, is_recipient: false %>");

<% publish_to "/private_messages/#{@recipient.id}" do %>
  $('#message-<%= @first_message.try(:id) %>').remove();
  $('.messages-wrapper').prepend("<%= j render 'message', message: @message, is_recipient: true %>");
  $('#message-<%= @first_message.try(:id) || @message.try(:id) %> .message-item').addClass('unread');
  $('#messageCount').text("<%= @message_count %>");
  $('#messageCount').removeClass('hide');
<% end %>