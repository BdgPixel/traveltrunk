/*
 * jQuery Plugin: Tokenizing Autocomplete Text Entry
 * Version 1.6.0
 *
 * Copyright (c) 2009 James Smith (http://loopj.com)
 * Licensed jointly under the GPL and MIT licenses,
 * choose which one suits your project best!
 *
 */
!function(e){var t={method:"GET",contentType:"json",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:!0,tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",prePopulate:null,processPrePopulate:!1,idPrefix:"token-input-",resultsFormatter:function(e){return"<li>"+e[this.propertyToSearch]+"</li>"},tokenFormatter:function(e){return"<li><p>"+e[this.propertyToSearch]+"</p></li>"},onResult:null,onAdd:null,onDelete:null,onReady:null},n={tokenList:"token-input-list",token:"token-input-token",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token"},o={BEFORE:0,AFTER:1,END:2},i={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},a={init:function(n,o){var i=e.extend({},t,o||{});return this.each(function(){e(this).data("tokenInputObject",new e.TokenList(this,n,i))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(e){return this.data("tokenInputObject").add(e),this},remove:function(e){return this.data("tokenInputObject").remove(e),this},get:function(){return this.data("tokenInputObject").getTokens()}};e.fn.tokenInput=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)},e.TokenList=function(t,a,s){function r(){return null!==s.tokenLimit&&_>=s.tokenLimit?(O.hide(),void g()):void 0}function l(){if(L!==(L=O.val())){var e=L.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");M.html(e),O.width(M.width()+30)}}function u(t){var n=s.tokenFormatter(t);n=e(n).addClass(s.classes.token).insertBefore(z),e("<span>"+s.deleteText+"</span>").addClass(s.classes.tokenDelete).appendTo(n).click(function(){return f(e(this).parent()),I.change(),!1});var o={id:t.id};return o[s.propertyToSearch]=t[s.propertyToSearch],e.data(n.get(0),"tokeninput",t),P=P.slice(0,N).concat([o]).concat(P.slice(N)),N++,m(P,I),_+=1,null!==s.tokenLimit&&_>=s.tokenLimit&&(O.hide(),g()),n}function c(t){var n=s.onAdd;if(_>0&&s.preventDuplicates){var o=null;if(B.children().each(function(){var n=e(this),i=e.data(n.get(0),"tokeninput");return i&&i.id===t.id?(o=n,!1):void 0}),o)return d(o),z.insertAfter(o),void O.focus()}(null==s.tokenLimit||_<s.tokenLimit)&&(u(t),r()),O.val(""),g(),e.isFunction(n)&&n.call(I,t)}function d(e){e.addClass(s.classes.selectedToken),j=e.get(0),O.val(""),g()}function p(e,t){e.removeClass(s.classes.selectedToken),j=null,t===o.BEFORE?(z.insertBefore(e),N--):t===o.AFTER?(z.insertAfter(e),N++):(z.appendTo(B),N=_),O.focus()}function h(t){var n=j;j&&p(e(j),o.END),n===t.get(0)?p(t,o.END):d(t)}function f(t){var n=e.data(t.get(0),"tokeninput"),o=s.onDelete,i=t.prevAll().length;i>N&&i--,t.remove(),j=null,O.focus(),P=P.slice(0,i).concat(P.slice(i+1)),N>i&&N--,m(P,I),_-=1,null!==s.tokenLimit&&O.show().val("").focus(),e.isFunction(o)&&o.call(I,n)}function m(t,n){var o=e.map(t,function(e){return e[s.tokenValue]});n.val(o.join(s.tokenDelimiter))}function g(){G.hide().empty(),$=null}function k(){G.css({position:"absolute",top:e(B).offset().top+e(B).outerHeight(),left:e(B).offset().left,zindex:999}).show()}function v(){s.searchingText&&(G.html("<p>"+s.searchingText+"</p>"),k())}function T(){s.hintText&&(G.html("<p>"+s.hintText+"</p>"),k())}function y(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function C(e,t,n){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","g"),y(t,n))}function E(t,n){if(n&&n.length){G.empty();var o=e("<ul>").appendTo(G).mouseover(function(t){w(e(t.target).closest("li"))}).mousedown(function(t){return c(e(t.target).closest("li").data("tokeninput")),I.change(),!1}).hide();e.each(n,function(n,i){var a=s.resultsFormatter(i);a=C(a,i[s.propertyToSearch],t),a=e(a).appendTo(o),n%2?a.addClass(s.classes.dropdownItem):a.addClass(s.classes.dropdownItem2),0===n&&w(a),e.data(a.get(0),"tokeninput",i)}),k(),s.animateDropdown?o.slideDown("fast"):o.show()}else s.noResultsText&&(G.html("<p>"+s.noResultsText+"</p>"),k())}function w(t){t&&($&&x(e($)),t.addClass(s.classes.selectedDropdownItem),$=t.get(0))}function x(e){e.removeClass(s.classes.selectedDropdownItem),$=null}function D(){var t=O.val().toLowerCase();t&&t.length&&(j&&p(e(j),o.AFTER),t.length>=s.minChars?(v(),clearTimeout(F),F=setTimeout(function(){b(t)},s.searchDelay)):g())}function b(t){var n=t+A(),o=S.get(n);if(o)E(t,o);else if(s.url){var i=A(),a={};if(a.data={},i.indexOf("?")>-1){var r=i.split("?");a.url=r[0];var l=r[1].split("&");e.each(l,function(e,t){var n=t.split("=");a.data[n[0]]=n[1]})}else a.url=i;a.data[s.queryParam]=t,a.type=s.method,a.dataType=s.contentType,s.crossDomain&&(a.dataType="jsonp"),a.success=function(o){e.isFunction(s.onResult)&&(o=s.onResult.call(I,o)),S.add(n,s.jsonContainer?o[s.jsonContainer]:o),O.val().toLowerCase()===t&&E(t,s.jsonContainer?o[s.jsonContainer]:o)},e.ajax(a)}else if(s.local_data){var u=e.grep(s.local_data,function(e){return e[s.propertyToSearch].toLowerCase().indexOf(t.toLowerCase())>-1});e.isFunction(s.onResult)&&(u=s.onResult.call(I,u)),S.add(n,u),E(t,u)}}function A(){var e=s.url;return"function"==typeof s.url&&(e=s.url.call()),e}if("string"===e.type(a)||"function"===e.type(a)){s.url=a;var R=A();void 0===s.crossDomain&&(-1===R.indexOf("://")?s.crossDomain=!1:s.crossDomain=location.href.split(/\/+/g)[1]!==R.split(/\/+/g)[1])}else"object"==typeof a&&(s.local_data=a);s.classes?s.classes=e.extend({},n,s.classes):s.theme?(s.classes={},e.each(n,function(e,t){s.classes[e]=t+"-"+s.theme})):s.classes=n;var F,L,P=[],_=0,S=new e.TokenList.Cache,O=e('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",s.idPrefix+t.id).focus(function(){(null===s.tokenLimit||s.tokenLimit!==_)&&T()}).blur(function(){g(),e(this).val("")}).bind("keyup keydown blur update",l).keydown(function(t){var n,a;switch(t.keyCode){case i.LEFT:case i.RIGHT:case i.UP:case i.DOWN:if(e(this).val()){var s=null;return s=t.keyCode===i.DOWN||t.keyCode===i.RIGHT?e($).next():e($).prev(),s.length&&w(s),!1}n=z.prev(),a=z.next(),n.length&&n.get(0)===j||a.length&&a.get(0)===j?t.keyCode===i.LEFT||t.keyCode===i.UP?p(e(j),o.BEFORE):p(e(j),o.AFTER):t.keyCode!==i.LEFT&&t.keyCode!==i.UP||!n.length?t.keyCode!==i.RIGHT&&t.keyCode!==i.DOWN||!a.length||d(e(a.get(0))):d(e(n.get(0)));break;case i.BACKSPACE:if(n=z.prev(),!e(this).val().length)return j?(f(e(j)),I.change()):n.length&&d(e(n.get(0))),!1;1===e(this).val().length?g():setTimeout(function(){D()},5);break;case i.TAB:case i.ENTER:case i.NUMPAD_ENTER:case i.COMMA:if($)return c(e($).data("tokeninput")),I.change(),!1;break;case i.ESCAPE:return g(),!0;default:String.fromCharCode(t.which)&&setTimeout(function(){D()},5)}}),I=e(t).hide().val("").focus(function(){O.focus()}).blur(function(){O.blur()}),j=null,N=0,$=null,B=e("<ul />").addClass(s.classes.tokenList).click(function(t){var n=e(t.target).closest("li");n&&n.get(0)&&e.data(n.get(0),"tokeninput")?h(n):(j&&p(e(j),o.END),O.focus())}).mouseover(function(t){var n=e(t.target).closest("li");n&&j!==this&&n.addClass(s.classes.highlightedToken)}).mouseout(function(t){var n=e(t.target).closest("li");n&&j!==this&&n.removeClass(s.classes.highlightedToken)}).insertBefore(I),z=e("<li />").addClass(s.classes.inputToken).appendTo(B).append(O),G=e("<div>").addClass(s.classes.dropdown).appendTo("body").hide(),M=e("<tester/>").insertAfter(O).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:O.css("fontSize"),fontFamily:O.css("fontFamily"),fontWeight:O.css("fontWeight"),letterSpacing:O.css("letterSpacing"),whiteSpace:"nowrap"});I.val("");var U=s.prePopulate||I.data("pre");s.processPrePopulate&&e.isFunction(s.onResult)&&(U=s.onResult.call(I,U)),U&&U.length&&e.each(U,function(e,t){u(t),r()}),e.isFunction(s.onReady)&&s.onReady.call(),this.clear=function(){B.children("li").each(function(){0===e(this).children("input").length&&f(e(this))})},this.add=function(e){c(e)},this.remove=function(t){B.children("li").each(function(){if(0===e(this).children("input").length){var n=e(this).data("tokeninput"),o=!0;for(var i in t)if(t[i]!==n[i]){o=!1;break}o&&f(e(this))}})},this.getTokens=function(){return P}},e.TokenList.Cache=function(t){var n=e.extend({max_size:500},t),o={},i=0,a=function(){o={},i=0};this.add=function(e,t){i>n.max_size&&a(),o[e]||(i+=1),o[e]=t},this.get=function(e){return o[e]}}}(jQuery),$("#formAddToSavings").on("submit",function(e){var t;return t=void 0,t=null,$("#update_credit_amount").val()||($(".payment-errors").html("Amount cannot be blank or zero or negative"),t=!1),0==$("#update_credit_amount").val()&&($(".payment-errors").html("Amount cannot be blank or zero or negative"),t=!1),$("#update_credit_amount").val()<0&&($(".payment-errors").html("Amount cannot be blank or zero or negative"),t=!1),t}),function(){var e;e=function(){$("#invitationForm").validate({ignore:".ignore",rules:{autocomplete:"required"},messages:{autocomplete:"Please enter your email invitation"}})},$(document).ready(function(){return e(),$("#invite_user_id").tokenInput("/group/users_collection.json",{allowCustomEntry:!0,preventDuplicates:!1,zindex:9999,resultsFormatter:function(e){return"<li><img src='"+e.image_url+"' title='"+e.name+"' height='50px' width='50px' /><div style='display: inline-block; padding-left: 10px;'><div class='full_name'>"+e.name+"</div><div class='email'>"+e.email+"</div></div></li>"},tokenFormatter:function(e){return"<li><p><img src='"+e.image_url+"' title='"+e.name+"' height='25px' width='25px' />&nbsp;"+e.name+"&nbsp;<b style='color: red'>"+e.email+"</b></p></li>"}}),$("#slideToggleLink").click(function(){return $("#slideToggle").slideToggle()})})}.call(this);